// 生成excel
const Excel = require('exceljs');

const createExcel = (head, data, sheetname, excelname) => {
	return new Promise((resovle, reject) => {
		const wb = new Excel.Workbook();
		wb.creator = 'me';
		wb.lastModifiedBy = 'Her';
		wb.created = new Date(1985, 8, 30);
		wb.modified = new Date();
		wb.lastPrinted = new Date(2020,3,27);
		wb.properties.date1904 = true;
		wb.views = [
			{
				x:0, y: 0, width: 10000, height: 20000,
				firstSheet: 0, activeTab: 1, visibility: 'visible'
			}
		];
		const sheetName = sheetname ? sheetname : 'sheet1';
		const sheet = wb.addWorksheet(sheetName);
		const ws = wb.getWorksheet(sheetName);
		const columns = [];
		for (let i = 0; i < head.length; i++) {
			const item  = head[i];
			columns.push({
				header: item,
				key: item,
				width: item.charCodeAt(0) > 255 ? item.length * 2 * 20 : item.length * 20
			})
		}
		ws.columns = [
			...columns
		];
		for (let i=0; i < data.length; i++) {
			const item  = data[i]
			ws.addRow(item);
			item['图片'] = 'data:image/jpeg;base64,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'
			if (item['图片']) {
				const itemPicArr = item['图片'].replace(/^.*?,/,'');
				console.log(i,itemPicArr);
			}
		}
		
		const xlsxName = `${excelname ? excelname : ''}${+new Date()}.xlsx`;
		wb.xlsx.writeFile(xlsxName)
			.then(function(){
					console.log('生成 xlsx');
					resovle(xlsxName);
			});
	})
};


module.exports = {
	createExcel
};